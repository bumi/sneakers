dist: trusty
sudo: true
language: ruby
cache: bundler
services:
  - rabbitmq
  - redis-server
before_install:
  - gem install bundler
before_script:
  - "./bin/ci/install_on_debian.sh"
  - until sudo lsof -i:5672; do echo "Waiting for RabbitMQ to start..."; sleep 1; done
rvm:
  - ruby-head
  - "2.7.0"
  - "2.6.5"
  - "2.5.7"
  - "2.4.9"
matrix:
  include:
    - rvm: "2.7.0"
      env: INTEGRATION_LOG=1 INTEGRATION=1
  allow_failures:
    rvm:
      - ruby-head
